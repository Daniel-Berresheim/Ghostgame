[gd_scene load_steps=7 format=2]

[ext_resource path="res://resources/objects/basic/Possessable.tscn" type="PackedScene" id=1]
[ext_resource path="res://resources/textures/objects/possessables/others/Boy.png" type="Texture" id=2]
[ext_resource path="res://resources/textures/lights/Sphere.png" type="Texture" id=3]

[sub_resource type="GDScript" id=1]

script/source = "extends KinematicBody2D

# todo:
# - can walk
# - can jump (1.5 blocks horizontaly and vertically)
# - no controll while jumping? (no direction change in midair)
# - has friction and gravity
# - no snapping while falling, normal movement calculation
# - sounds
# - animations
# - falldamage (dies from a height of slightly less than 3 blocks)
# - dies if movables fall on it
# - dying: the player falls over with an animation and sound; the screen fades out and the level resets
# - some humans have other abilities, which are shown on the sprite; e.g. cannot be possessed

# todo (later):
# - will be scared of some actions of the player and from movables
# - can run away in fear
# - maybe they have a value of how likely they are to be afraid
# - this value can be raised if it's dark, etc. and through events
# - adults could have a higher resistance to scary things

# gravity applied on the character
export var gravity = Vector2(0, 7000)

# The current speed of the human.
var speed = Vector2(0.0, 0.0)

# Movement that actually occured since the last _physics_process.
var actual_movement = Vector2()

# True if colliding with ground.
var on_ground = true

func _ready():
	
	print(\"Saft\")
	pass

func _physics_process(delta):
	
	# tests, whether the player is on ground
	var on_ground_new = test_move(global_transform, Vector2(0, 1))
	print(on_ground_new)
	
	if on_ground_new:
		
		print(\"On Ground\")
		
	else:
		
		speed += gravity * delta
		
	on_ground = on_ground_new
	
	actual_movement = global_position
	move_and_slide(speed, Vector2(0, -1))
	actual_movement = (actual_movement - global_position) / delta
	pass
"

[sub_resource type="CircleShape2D" id=2]

custom_solver_bias = 0.0
radius = 14.0

[sub_resource type="CapsuleShape2D" id=3]

custom_solver_bias = 0.0
radius = 6.48239
height = 11.4675

[node name="Human" type="KinematicBody2D" index="0"]

z_index = 7
input_pickable = false
collision_layer = 8
collision_mask = 11
collision/safe_margin = 0.08
script = SubResource( 1 )
_sections_unfolded = [ "Collision", "Z Index" ]
gravity = Vector2( 0, 7000 )

[node name="Possessable" parent="." index="0" instance=ExtResource( 1 )]

[node name="PossessArea" type="CollisionShape2D" parent="Possessable" index="2"]

position = Vector2( -1, -1 )
shape = SubResource( 2 )

[node name="Sprite" type="Sprite" parent="." index="1"]

texture = ExtResource( 2 )
hframes = 8
_sections_unfolded = [ "Animation" ]

[node name="CollisionShape2D" type="CollisionShape2D" parent="." index="2"]

position = Vector2( 0, 3 )
shape = SubResource( 3 )
_sections_unfolded = [ "Transform" ]

[node name="Light2D" type="Light2D" parent="." index="3"]

enabled = true
editor_only = false
texture = ExtResource( 3 )
offset = Vector2( 0, 0 )
texture_scale = 1.0
color = Color( 1, 1, 1, 1 )
energy = 0.6
mode = 0
range_height = 0.0
range_z_min = -1024
range_z_max = 1024
range_layer_min = 0
range_layer_max = 0
range_item_cull_mask = 1
shadow_enabled = false
shadow_color = Color( 0, 0, 0, 0 )
shadow_buffer_size = 2048
shadow_gradient_length = 0.0
shadow_filter = 0
shadow_filter_smooth = 0.0
shadow_item_cull_mask = 1


